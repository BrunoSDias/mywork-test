  <script>
    var map_container = document.getElementById('map');
    var cmarker = "";
    var ccircle = ""

    function initMap() {
      setCoords()
    }

    function placeMarkerAndPanTo(latLng, map) {
      clearMarkersCircles()
      var marker = new google.maps.Marker({
        position: latLng,
        map: map
      });

      cmarker = marker;
      ccircle = drawCircle(map, latLng, parseFloat(document.getElementById('geofence_radius').value))
      map.panTo(latLng);
    }

    function setCoords(){
      var position = verifyStart();

      var map = new google.maps.Map(map_container, {
        zoom: 8,
        center: position
      });

      map.addListener('click', function(e) {
        placeMarkerAndPanTo(e.latLng, map);
        document.getElementById('geofence_latitude').value = e.latLng.lat();
        document.getElementById('geofence_longitude').value = e.latLng.lng();
      });

      placeMarkerAndPanTo({lat: position.lat, lng: position.lng}, map)
    }

    function clearMarkersCircles() {
      if (!cmarker == "")
        cmarker.setMap(null);
      if (!ccircle == "")
        ccircle.setMap(null);
    }

    function drawCircle(map, center, radius){
      var options = {
        strokeColor: '#FF0000',
        strokeOpacity: 0.5,
        strokeWeight: 2,
        fillColor: '#FF0000',
        fillOpacity: 0.35,
        map: map,
        center: center,
        radius: radius
      }
      return cityCircle = new google.maps.Circle(options);
    }

    function verifyStart(){
      if (document.getElementById('geofence_latitude').value != ""){
        latt = parseFloat(document.getElementById('geofence_latitude').value);
        lngg = parseFloat(document.getElementById('geofence_longitude').value);
      }
      else{
        latt = 0;
        lngg = 0;
      }
      return {lat: latt, lng: lngg}
    }
  </script>

